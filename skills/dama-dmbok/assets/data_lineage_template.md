# データリネージドキュメント（Data Lineage Document）

## ドキュメント情報

| 項目 | 内容 |
|------|------|
| 対象データ | [データ資産名] |
| 作成日 | YYYY-MM-DD |
| 作成者 | [氏名] |
| バージョン | 1.0 |

---

## 1. リネージ概要

### 1.1 対象データ資産

| 項目 | 内容 |
|------|------|
| **データ資産名** | [日本語名] |
| **物理名** | [スキーマ.テーブル名] |
| **システム** | [システム名] |
| **Data Owner** | [氏名/部門] |

### 1.2 リネージの目的

- [ ] 影響分析（ソース変更時の影響範囲特定）
- [ ] 根本原因分析（データ問題の原因追跡）
- [ ] コンプライアンス（データの出所証明）
- [ ] 変更管理（変更の影響評価）
- [ ] その他: ________________

---

## 2. 全体リネージ図

### 2.1 ハイレベル図

```
┌─────────────────────────────────────────────────────────────────────┐
│                         データリネージ全体図                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ソース層           統合層           ターゲット層       消費層      │
│                                                                     │
│ ┌─────────┐                                                        │
│ │ [Source1]│──┐                                                    │
│ │ システム  │  │                                                    │
│ └─────────┘  │      ┌─────────┐      ┌─────────┐                  │
│              ├─────▶│ [ETL1]  │─────▶│[Target] │      ┌─────────┐ │
│ ┌─────────┐  │      │ 処理    │      │ DWH     │─────▶│[Report1]│ │
│ │ [Source2]│──┤      └─────────┘      └────┬────┘      └─────────┘ │
│ │ システム  │  │                           │                       │
│ └─────────┘  │                           │          ┌─────────┐  │
│              │                           └─────────▶│[Report2]│  │
│ ┌─────────┐  │                                      └─────────┘  │
│ │ [Source3]│──┘                                                    │
│ │ 外部データ│                                                       │
│ └─────────┘                                                        │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2 リネージサマリー

| レイヤー | システム/プロセス数 | データ資産数 |
|---------|-------------------|-------------|
| ソース | ___個 | ___件 |
| 統合（ETL） | ___個 | - |
| ターゲット | ___個 | ___件 |
| 消費 | ___個 | ___件 |

---

## 3. ソースシステム詳細

### 3.1 ソース一覧

| # | ソース名 | システム種別 | 所有者 | 更新頻度 |
|---|---------|-------------|--------|---------|
| 1 | [ソース1] | □基幹 □CRM □外部 □その他 | | □リアルタイム □日次 □週次 |
| 2 | [ソース2] | □基幹 □CRM □外部 □その他 | | □リアルタイム □日次 □週次 |
| 3 | [ソース3] | □基幹 □CRM □外部 □その他 | | □リアルタイム □日次 □週次 |

### 3.2 ソース詳細

#### ソース1: [ソース名]

| 項目 | 内容 |
|------|------|
| **システム名** | |
| **テーブル/ファイル** | |
| **抽出カラム** | |
| **抽出条件** | |
| **データ量** | ___レコード/日 |
| **品質スコア** | ___% |

**カラムマッピング:**

| ソースカラム | データ型 | ターゲットカラム | 変換 |
|-------------|----------|-----------------|------|
| | | | □なし □型変換 □計算 □マッピング |
| | | | □なし □型変換 □計算 □マッピング |
| | | | □なし □型変換 □計算 □マッピング |

---

## 4. 変換プロセス詳細

### 4.1 変換プロセス一覧

| # | プロセス名 | 種別 | スケジュール | 所要時間 |
|---|-----------|------|-------------|---------|
| 1 | [ETL1] | □ETL □ELT □CDC □API | | 約___分 |
| 2 | [ETL2] | □ETL □ELT □CDC □API | | 約___分 |

### 4.2 変換詳細

#### ETL1: [プロセス名]

| 項目 | 内容 |
|------|------|
| **ジョブ名** | |
| **ツール** | □Informatica □Talend □SSIS □Airflow □dbt □その他 |
| **実行スケジュール** | |
| **依存関係** | |
| **SLA** | |

**変換ステップ:**

```
Step 1: 抽出（Extract）
├── ソース: [テーブル名]
├── 抽出条件: [WHERE句]
└── 出力: [件数]

Step 2: クレンジング
├── NULL除去: [カラム名]
├── 標準化: [カラム名]（大文字変換等）
└── 出力: [件数]

Step 3: 変換（Transform）
├── 結合: [テーブルA] JOIN [テーブルB] ON [条件]
├── 集計: SUM([カラム]) GROUP BY [カラム]
├── 計算: [派生カラム] = [計算式]
└── 出力: [件数]

Step 4: ロード（Load）
├── ターゲット: [テーブル名]
├── ロード方式: □全件洗替 □差分 □Append □Merge
└── 出力: [件数]
```

**エラーハンドリング:**

| エラー種別 | 対処 | 通知先 |
|-----------|------|--------|
| ソース接続エラー | □リトライ □中断 □スキップ | |
| データ品質エラー | □リジェクト □修正 □中断 | |
| ターゲット書き込みエラー | □ロールバック □リトライ | |

---

## 5. カラムレベルリネージ

### 5.1 カラムマッピング一覧

| # | ターゲットカラム | ソース1 | ソース2 | 変換ロジック |
|---|-----------------|---------|---------|-------------|
| 1 | customer_key | customer_id | - | HASH関数適用 |
| 2 | full_name | first_name, last_name | - | CONCAT |
| 3 | email | email | email | COALESCE（優先: ソース1） |
| 4 | total_amount | - | order_amt | SUM集計 |
| 5 | last_update_dt | - | - | CURRENT_TIMESTAMP |

### 5.2 カラム詳細リネージ

#### ターゲットカラム: [カラム名]

```
ソース                      変換                      ターゲット
┌─────────────────┐                              ┌─────────────────┐
│ Source1         │                              │ Target          │
│ ─────────────── │                              │ ─────────────── │
│ first_name      │──┐                          │                 │
│                 │  │    ┌──────────────┐      │                 │
└─────────────────┘  ├───▶│   CONCAT     │─────▶│ full_name       │
                     │    │ (space区切り)  │      │                 │
┌─────────────────┐  │    └──────────────┘      │                 │
│ Source1         │  │                          │                 │
│ ─────────────── │──┘                          │                 │
│ last_name       │                              │                 │
└─────────────────┘                              └─────────────────┘
```

**変換ロジック詳細:**
```sql
-- ロジック説明
full_name = TRIM(first_name) || ' ' || TRIM(last_name)

-- NULL処理
CASE
  WHEN first_name IS NULL AND last_name IS NULL THEN NULL
  WHEN first_name IS NULL THEN last_name
  WHEN last_name IS NULL THEN first_name
  ELSE first_name || ' ' || last_name
END
```

---

## 6. 下流リネージ

### 6.1 下流システム一覧

| # | 下流システム | データ資産 | 用途 | 利用者 |
|---|-------------|-----------|------|--------|
| 1 | [BIツール] | [レポート名] | 経営レポート | 経営層 |
| 2 | [アプリ] | [画面名] | 顧客照会 | 営業部 |
| 3 | [データマート] | [テーブル名] | 分析用 | アナリスト |

### 6.2 影響範囲

**このデータが変更された場合の影響:**

```
┌─────────────────────────────────────────────────────────────────────┐
│                         影響範囲図                                   │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│                     ┌─────────────────┐                             │
│                     │  [対象データ]   │                             │
│                     │  ★変更発生     │                             │
│                     └────────┬────────┘                             │
│                              │                                      │
│           ┌──────────────────┼──────────────────┐                   │
│           │                  │                  │                   │
│           ▼                  ▼                  ▼                   │
│    ┌────────────┐     ┌────────────┐     ┌────────────┐            │
│    │ データマート │     │ レポートA  │     │ アプリX    │            │
│    │ ⚠️ 影響    │     │ ⚠️ 影響    │     │ ⚠️ 影響    │            │
│    └─────┬──────┘     └─────┬──────┘     └────────────┘            │
│          │                  │                                       │
│          ▼                  ▼                                       │
│    ┌────────────┐     ┌────────────┐                               │
│    │ レポートB  │     │ ダッシュボード│                               │
│    │ ⚠️ 影響    │     │ ⚠️ 影響    │                               │
│    └────────────┘     └────────────┘                               │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

**影響サマリー:**

| 影響レベル | 影響を受けるシステム/レポート | 対応必要性 |
|-----------|----------------------------|-----------|
| 高 | | □必須 □推奨 |
| 中 | | □必須 □推奨 |
| 低 | | □必須 □推奨 |

---

## 7. データ品質チェックポイント

### 7.1 チェックポイント一覧

| # | チェックポイント | チェック内容 | 頻度 | 閾値 |
|---|-----------------|-------------|------|------|
| 1 | ソース抽出後 | レコード件数チェック | 日次 | 前日比±10% |
| 2 | 変換処理後 | NULL率チェック | 日次 | ≤5% |
| 3 | ロード後 | 整合性チェック | 日次 | 100% |
| 4 | ロード後 | 重複チェック | 日次 | 0件 |

### 7.2 品質ルール

| ルール | 対象 | 条件 | アクション |
|--------|------|------|-----------|
| ソース件数 | 抽出データ | 0件でないこと | アラート発報 |
| リジェクト率 | 変換処理 | ≤1% | ログ記録 |
| 整合性 | ソース vs ターゲット | 件数一致 | アラート発報 |

---

## 8. 運用情報

### 8.1 スケジュール

| プロセス | 開始時刻 | 終了予定 | 依存 |
|---------|---------|---------|------|
| ソース抽出 | __:__ | __:__ | なし |
| 変換処理 | __:__ | __:__ | ソース抽出完了 |
| ロード | __:__ | __:__ | 変換処理完了 |
| 品質チェック | __:__ | __:__ | ロード完了 |

### 8.2 監視・アラート

| 監視項目 | 閾値 | 通知先 | 通知方法 |
|---------|------|--------|---------|
| ジョブ失敗 | 発生時 | | □メール □Slack □電話 |
| 処理遅延 | SLA超過 | | □メール □Slack □電話 |
| 品質低下 | スコア<___% | | □メール □Slack □電話 |

### 8.3 担当者

| 役割 | 担当者 | 連絡先 | 対応時間 |
|------|--------|--------|---------|
| 1次対応 | | | |
| エスカレーション先 | | | |
| Data Owner | | | |

---

## 9. 変更履歴

### 9.1 リネージ変更履歴

| 日付 | 変更種別 | 変更内容 | 変更者 | 承認者 |
|------|---------|----------|--------|--------|
| YYYY-MM-DD | □ソース追加 □変換変更 □ターゲット変更 | | | |
| YYYY-MM-DD | □ソース追加 □変換変更 □ターゲット変更 | | | |

### 9.2 影響分析記録

| 日付 | 変更内容 | 影響範囲 | 対応内容 |
|------|---------|---------|---------|
| YYYY-MM-DD | | | |
| YYYY-MM-DD | | | |

---

## 付録

### A. 用語集

| 用語 | 説明 |
|------|------|
| リネージ | データの起源から終点までの流れ |
| フォワードリネージ | ソース→ターゲット方向の追跡 |
| バックワードリネージ | ターゲット→ソース方向の追跡 |
| ETL | Extract-Transform-Load |
| CDC | Change Data Capture |

### B. 関連ドキュメント

| ドキュメント | リンク/場所 |
|-------------|------------|
| データカタログ | |
| ETLジョブ仕様書 | |
| データモデル | |
| 品質ルール定義 | |
