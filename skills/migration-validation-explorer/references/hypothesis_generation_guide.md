# Hypothesis Generation Guide

観点別の仮説生成プロンプトガイド

---

## 4つの観点（ペルソナ）

### 🏢 ドメインエキスパート

**役割**: ビジネスルールと業務フローの専門家

**質問テンプレート**:
- このデータが表すビジネスプロセスで、どのようなルール違反が起こりうるか？
- 業界固有の規制やコンプライアンス要件を満たしているか？
- ユーザーの期待するビジネスロジックと実装が一致しているか？
- 例外的なビジネスケースが正しく処理されているか？

**仮説生成プロンプト**:
```
[領域]に関して、ドメインエキスパートの観点から:

1. このデータが違反する可能性のあるビジネスルールは？
2. 業界標準やベストプラクティスから逸脱しているケースは？
3. ユーザーが予期する動作と異なる可能性のある点は？
4. 監査や規制の観点で問題になりうる点は？
```

---

### 💻 技術実装者

**役割**: コードとデータ変換の専門家

**質問テンプレート**:
- データ変換ロジックにバグがある可能性は？
- 型変換、エンコーディング、フォーマット変換で問題が起きていないか？
- NULL/空白/デフォルト値の処理は適切か？
- エッジケースでの処理が想定通りか？

**仮説生成プロンプト**:
```
[領域]に関して、技術実装者の観点から:

1. データ変換ロジックで失敗しうるケースは？
2. 型不一致やフォーマット変換エラーの可能性は？
3. NULL/空白値の処理に問題がある可能性は？
4. 並行処理や順序依存性の問題は？
```

---

### 🔍 エッジケース探索者

**役割**: 境界条件と特殊ケースの発見者

**質問テンプレート**:
- 入力データの境界値（最大/最小/空）での動作は？
- 通常とは異なるパターンのデータが存在するか？
- 複数の条件が組み合わさった複雑なケースは？
- 履歴データや古いレコードで問題が起きていないか？

**仮説生成プロンプト**:
```
[領域]に関して、エッジケース探索者の観点から:

1. 極端な値（最大/最小/ゼロ/負）での問題は？
2. 珍しい文字（特殊文字、Unicode、空白）を含むデータは？
3. 複数の例外条件が重なるケースは？
4. レガシーデータや移行前の古い形式のデータは？
```

---

### 📊 統計懐疑論者

**役割**: データ分布と異常パターンの分析者

**質問テンプレート**:
- データの分布が期待通りか？偏りはないか？
- 外れ値や異常値が存在するか？
- 時系列での傾向やパターンに異常はないか？
- カテゴリ間の比率は妥当か？

**仮説生成プロンプト**:
```
[領域]に関して、統計懐疑論者の観点から:

1. データ分布に不自然な偏りはないか？
2. 特定の値への過度な集中（>50%）はないか？
3. 時系列での急激な変化や断絶はないか？
4. カテゴリ別の件数比率は妥当か？
```

---

## 領域別の仮説テンプレート

### OwnerId検証

| 観点 | 仮説例 |
|------|--------|
| 🏢 | フォールバック所有者が不適切な部門のマネージャーになっている |
| 💻 | TEMP User IDが本番環境で使用されたまま |
| 🔍 | 退職者のIDが割り当てられたままのレコードがある |
| 📊 | 特定の所有者に50%以上のレコードが集中している |

### Status/Stage検証

| 観点 | 仮説例 |
|------|--------|
| 🏢 | ステータスとステージの組み合わせがビジネスルールに違反 |
| 💻 | ソースシステムの値がマッピング定義に存在しない |
| 🔍 | Closed Won/Lostなのに金額やクローズ日が未設定 |
| 📊 | 特定のステータスに異常な割合のレコードが集中 |

### Lookup参照検証

| 観点 | 仮説例 |
|------|--------|
| 🏢 | 親子関係が業務上の実態と異なる |
| 💻 | ID形式（int vs float）の不一致で参照解決に失敗 |
| 🔍 | 循環参照や自己参照が存在する |
| 📊 | 参照先が存在しない「孤児」レコードの割合が異常 |

### 住所正規化検証

| 観点 | 仮説例 |
|------|--------|
| 🏢 | 海外物件（カナダ、グアム等）が米国形式で処理されている |
| 💻 | 正規化で元の情報が欠落している |
| 🔍 | ユニット番号のない集合住宅が重複として誤検出 |
| 📊 | 正規化後に重複キーを持つレコードが多すぎる |

---

## 仮説の優先度付け

### 優先度スコア計算

```
Priority Score = Impact × Probability × Testability
```

| 要素 | 高(3) | 中(2) | 低(1) |
|------|-------|-------|-------|
| 影響度 | 全レコード | 一部カテゴリ | 稀なケース |
| 発生確率 | 高い | 中程度 | 低い |
| テスト可能性 | 単純なクエリ | 複合条件 | 手動確認必要 |

**優先度しきい値**:
- 18-27: 最優先で検証
- 8-17: 標準優先度
- 1-7: 時間があれば検証

---

## 仮説検証のチェックリスト

検証前:
- [ ] 仮説が具体的かつテスト可能な形式で記述されている
- [ ] 成功/失敗の判定基準が明確
- [ ] 検証に必要なデータにアクセス可能

検証中:
- [ ] クエリ/コードが再現可能な形で記録されている
- [ ] 結果の数値が正確に記録されている
- [ ] 予期しない発見も記録している

検証後:
- [ ] 根本原因の分析が完了
- [ ] 影響範囲の評価が完了
- [ ] 推奨アクションが具体的
