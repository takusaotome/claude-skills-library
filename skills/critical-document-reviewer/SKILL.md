# Critical Document Reviewer

---
name: critical-document-reviewer
description: |
  設計文書、分析レポート、報告書などを批判的な視点で徹底レビューするスキル。
  3つの異なる立場（開発メンバー、PM、お客様）のペルソナを持つサブエージェントが並列でレビューを実行し、
  「本当にそうか？」「根拠は何か？」という視点で曖昧さ、根拠不足、論理飛躍を検出する。
  Use when reviewing design documents, analysis reports, incident reports, or any document requiring rigorous validation of claims and evidence.
---

## Overview

このスキルは、ドキュメントを複数の視点から批判的にレビューし、以下を検出します：

- **根拠不足**: 主張に対する証拠がない
- **推測混入**: 検証なしの推測が事実として記載
- **論理飛躍**: A→Cの間のBが欠落
- **トレーサビリティ欠如**: 要件や元データとの紐付けがない
- **確証バイアス**: 都合の良い解釈のみ採用

## Multi-Persona Review Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    スキル（オーケストレーター）                  │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Phase 1: 準備                                        │   │
│  │ - 文書タイプ特定                                      │   │
│  │ - 関連文書収集                                        │   │
│  │ - ペルソナ選定                                        │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                 │
│            ┌──────────────┼──────────────┐                 │
│            ▼              ▼              ▼                 │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│  │ Reviewer 1  │ │ Reviewer 2  │ │ Reviewer 3  │  並列    │
│  │ 開発メンバー │ │     PM      │ │  お客様     │  実行    │
│  └─────────────┘ └─────────────┘ └─────────────┘          │
│            │              │              │                 │
│            └──────────────┼──────────────┘                 │
│                           ▼                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Phase 3: 統合                                        │   │
│  │ - 重複排除                                            │   │
│  │ - 重大度付与                                          │   │
│  │ - 総合レビューレポート生成                              │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## Workflow

### Phase 1: 準備（Preparation）

1. **文書タイプの特定**
   - 設計文書（Design Document）
   - 不具合分析レポート（Incident/Bug Analysis Report）
   - 要件定義書（Requirements Document）
   - 提案書（Proposal）
   - その他報告書

2. **関連文書の収集**
   - 設計文書の場合: 元の要件定義書、前工程のドキュメント
   - 不具合分析の場合: ログファイル、データ、証拠となる資料
   - ユーザーに関連文書の有無を確認

3. **ペルソナの選定**（文書タイプに応じて自動選定）

   | 文書タイプ | Reviewer 1 | Reviewer 2 | Reviewer 3 |
   |-----------|------------|------------|------------|
   | 設計文書 | 開発者 | アーキテクト | テスター |
   | 不具合分析 | 開発者 | QA | PM |
   | 要件定義 | 開発者 | PM | 顧客 |
   | 提案書 | 技術者 | 営業 | 顧客 |
   | 汎用 | 開発メンバー | PM | お客様 |

### Phase 2: 並列レビュー（Parallel Review）

3つのサブエージェント（`critical-reviewer-persona-1`, `critical-reviewer-persona-2`, `critical-reviewer-persona-3`）を**並列実行**します。

各サブエージェントには以下を渡します：
- レビュー対象文書
- 関連文書（あれば）
- ペルソナ定義（references/persona_definitions.md から該当部分）
- 批判的分析フレームワーク（references/critical_analysis_framework.md）

**サブエージェント呼び出し例:**

```
Task tool を使用して3つのサブエージェントを並列起動：

1. critical-reviewer-persona-1: 開発メンバー視点でレビュー
2. critical-reviewer-persona-2: PM視点でレビュー
3. critical-reviewer-persona-3: お客様視点でレビュー
```

### Phase 3: 統合（Integration）

サブエージェントからの結果を統合：

1. **指摘事項の収集**
   - 3つのレビュー結果を収集
   - 各指摘事項を構造化

2. **重複排除**
   - 同じ問題を異なる視点で指摘している場合は統合
   - 視点の違いは「関連ペルソナ」として記録

3. **重大度の付与**

   | 重大度 | 定義 | 例 |
   |--------|------|-----|
   | **Critical** | 根拠なし、または重大な論理誤謬 | 結論に証拠がない |
   | **Major** | 根拠不十分、曖昧さが実害を招く | 「〜と思われる」が重要判断に |
   | **Minor** | 表現の改善が望ましい | 曖昧だが影響は軽微 |
   | **Info** | 参考情報、改善提案 | より良い表現の提案 |

4. **総合レビューレポート生成**
   - assets/review_report_template.md を使用

## Persona Definitions

### Persona 1: 開発メンバー / Implementer

**役割**: 実際にこの文書を元に作業する人

**主な関心事**:
- 実装可能性: これで本当に実装できるか？
- 技術的正確性: 技術的な記述は正しいか？
- 曖昧さ: 解釈の余地がある箇所はないか？
- 前提条件: 前提は明示されているか？妥当か？
- 実務上の懸念: 実際にやろうとすると困る点はないか？

**問いかけ例**:
- 「この仕様で実装を始められるか？」
- 「不明点を誰かに確認せずに進められるか？」
- 「この前提条件は本当に成り立つか？」

### Persona 2: プロジェクトマネージャー / PM

**役割**: プロジェクト全体を管理する人

**主な関心事**:
- リスク: 見落としているリスクはないか？
- 整合性: 他のドキュメントや決定事項との矛盾はないか？
- 実現性: スケジュール・リソースの観点で現実的か？
- 依存関係: 他タスクとの依存は明確か？
- 完成度: このまま次工程に進めて大丈夫か？

**問いかけ例**:
- 「このドキュメントに従って進めてプロジェクトは成功するか？」
- 「記載されていないリスクはないか？」
- 「前工程のドキュメントと矛盾していないか？」

### Persona 3: お客様 / Customer

**役割**: 最終的な成果物を受け取る人

**主な関心事**:
- 要件充足: 要件を満たしているか？
- 期待との整合: 期待していたものと合っているか？
- 理解しやすさ: 内容を理解できるか？
- ビジネス価値: ビジネス目的を達成できるか？
- 受け入れ可能性: これを受け入れられるか？

**問いかけ例**:
- 「これは私が求めていたものか？」
- 「なぜこの設計になったのか理解できるか？」
- 「要件と紐付けて説明されているか？」

## Critical Analysis Framework

各レビュアーは以下のフレームワークを適用します：

### 1. 主張の特定（Claim Identification）

文書内の主張・結論を抽出:
- 明示的な結論（「〜である」「〜とする」）
- 暗黙の前提（言及されていないが仮定されている事項）
- 判断・決定事項

### 2. 根拠の検証（Evidence Validation）

各主張に対して:

```
┌─────────────────────────────────────────────┐
│ 主張: [主張内容]                              │
├─────────────────────────────────────────────┤
│ Q1: これは事実か、解釈か？                    │
│ Q2: 根拠は明示されているか？                  │
│ Q3: その根拠は十分か？                        │
│ Q4: 根拠の出典は信頼できるか？                │
│ Q5: 他の解釈・説明は検討されたか？            │
└─────────────────────────────────────────────┘
```

### 3. 論理の検証（Logic Validation）

- **因果関係の検証**: AがBの原因と言えるか？相関ではないか？
- **論理の連鎖**: A→B→Cの各ステップは妥当か？
- **前提条件**: 暗黙の前提は正しいか？
- **一般化の妥当性**: 特定の事例から一般化できるか？

### 4. 危険な表現パターン（Red Flag Patterns）

以下の表現を検出したら重点的に検証:

| パターン | 例 | 問題 |
|---------|-----|------|
| 推測表現 | 「〜と思われる」「おそらく」 | 根拠なしの推測？ |
| 断定表現 | 「〜に違いない」「明らかに」 | 根拠は十分か？ |
| 曖昧な主語 | 「一般的に」「通常」 | 具体的な根拠は？ |
| 省略 | 「等」「など」 | 何が省略されている？ |
| 因果の飛躍 | 「〜なので〜である」 | 論理の飛躍はないか？ |

## Output Format

レビュー結果は以下の形式で出力:

```markdown
# 批判的レビューレポート

## 文書情報
- 対象文書: [文書名]
- 文書タイプ: [タイプ]
- レビュー日: [日付]
- 関連文書: [あれば記載]

## レビューサマリー

| 重大度 | 件数 |
|--------|------|
| Critical | X |
| Major | X |
| Minor | X |
| Info | X |

## 指摘事項一覧

### Critical

#### [CR-001] [タイトル]
- **該当箇所**: [文書内の該当部分]
- **問題**: [何が問題か]
- **根拠評価**: [根拠がない/不十分な理由]
- **関連ペルソナ**: [どの視点から検出されたか]
- **推奨アクション**: [どう修正すべきか]

### Major
...

## ペルソナ別レビュー詳細

### 開発メンバー視点
[詳細]

### PM視点
[詳細]

### お客様視点
[詳細]

## 総合評価

[文書全体の評価と推奨事項]
```

## Usage Example

```
User: この設計書をレビューしてください。要件定義書も添付します。

Claude:
1. [Phase 1] 文書を分析し、設計文書と判断。ペルソナを選定。
2. [Phase 2] 3つのサブエージェントを並列起動:
   - 開発者視点でレビュー
   - アーキテクト視点でレビュー
   - テスター視点でレビュー
3. [Phase 3] 結果を統合し、レビューレポートを生成。
```

## Files

- `references/critical_analysis_framework.md` - 批判的分析の詳細フレームワーク
- `references/persona_definitions.md` - ペルソナの詳細定義
- `references/evidence_evaluation_criteria.md` - 証拠評価基準
- `references/red_flag_patterns.md` - 危険な表現パターン集
- `assets/review_report_template.md` - レビューレポートテンプレート
