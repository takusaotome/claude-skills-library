---
name: critical-document-reviewer
description: |
  設計文書、分析レポート、報告書などを批判的な視点で徹底レビューするスキル。
  6つの異なる立場（開発者、PM、顧客、QA、セキュリティ、運用）のペルソナを持つサブエージェントが並列でレビューを実行し、
  「本当にそうか？」「根拠は何か？」「テストできるか？」「運用できるか？」という視点で
  曖昧さ、根拠不足、論理飛躍、テスト不能、セキュリティリスク、運用懸念を検出する。
  Use when reviewing design documents, analysis reports, incident reports, or any document requiring rigorous validation of claims and evidence.
---

# Critical Document Reviewer

## Overview

このスキルは、ドキュメントを複数の視点（6ペルソナ）から批判的にレビューし、以下を検出します：

- **根拠不足**: 主張に対する証拠がない
- **推測混入**: 検証なしの推測が事実として記載
- **論理飛躍**: A→Cの間のBが欠落
- **トレーサビリティ欠如**: 要件や元データとの紐付けがない
- **確証バイアス**: 都合の良い解釈のみ採用
- **テスト不能**: 受入基準が曖昧でテストできない
- **セキュリティリスク**: 認証・認可・データ保護の考慮漏れ
- **運用懸念**: 監視・障害対応・保守性の考慮漏れ

## When to Use

- 設計文書（システム設計書、API設計書、DB設計書など）のレビュー
- 要件定義書・仕様書のレビュー
- 不具合分析レポート・インシデントレポートのレビュー
- 提案書・企画書のレビュー
- セキュリティ設計書のレビュー
- 運用設計書・運用手順書のレビュー
- 重要文書の公開・納品前の最終チェック
- 「本当にこの内容で問題ないか？」と確認したい場面

## Prerequisites

- レビュー対象となるドキュメントファイル
- （推奨）関連文書（元の要件定義書、前工程のドキュメント、ログファイルなど）

## Resources

### References
- `references/critical_analysis_framework.md` - 批判的分析の詳細フレームワーク
- `references/persona_definitions.md` - ペルソナの詳細定義
- `references/evidence_evaluation_criteria.md` - 証拠評価基準
- `references/red_flag_patterns.md` - 危険な表現パターン集

### Assets
- `assets/review_report_template.md` - レビューレポートテンプレート

### Agents
- `agents/document-reviewer-developer.md` - Developer/Implementer ペルソナ
- `agents/document-reviewer-pm.md` - Project Manager ペルソナ
- `agents/document-reviewer-customer.md` - Customer/Stakeholder ペルソナ
- `agents/document-reviewer-qa.md` - QA/Tester ペルソナ
- `agents/document-reviewer-security.md` - Security/Compliance ペルソナ
- `agents/document-reviewer-ops.md` - Operations/SRE ペルソナ

## Multi-Persona Review Architecture

```
┌──────────────────────────────────────────────────────────────────────────┐
│                       スキル（オーケストレーター）                           │
│  ┌────────────────────────────────────────────────────────────────┐     │
│  │ Phase 1: 準備                                                   │     │
│  │ - 文書タイプ特定 → 関連文書収集 → ペルソナ選定（3〜6ペルソナ）       │     │
│  └────────────────────────────────────────────────────────────────┘     │
│                                    │                                     │
│       ┌────────┬────────┬────────┬┴───────┬────────┬────────┐          │
│       ▼        ▼        ▼        ▼        ▼        ▼                    │
│  ┌────────┐┌────────┐┌────────┐┌────────┐┌────────┐┌────────┐          │
│  │Developer││   PM   ││Customer││   QA   ││Security││  Ops   │  並列    │
│  │ 開発者  ││  PM    ││ 顧客   ││ QA担当 ││セキュリティ││ 運用   │  実行    │
│  └────────┘└────────┘└────────┘└────────┘└────────┘└────────┘          │
│       │        │        │        │        │        │                    │
│       └────────┴────────┴────────┴────────┴────────┘                    │
│                                    ▼                                     │
│  ┌────────────────────────────────────────────────────────────────┐     │
│  │ Phase 3: 統合                                                   │     │
│  │ - 重複排除 → 重大度付与 → 総合レビューレポート生成                  │     │
│  └────────────────────────────────────────────────────────────────┘     │
└──────────────────────────────────────────────────────────────────────────┘
```

### 6 Personas Overview

| ペルソナ | 視点 | 主な検出対象 |
|---------|------|-------------|
| **Developer** | 実装可能性 | 技術的曖昧さ、情報欠落 |
| **PM** | プロジェクト管理 | リスク、整合性、依存関係 |
| **Customer** | 要件充足 | 期待値整合、ビジネス価値 |
| **QA** | テスト可能性 | 受入基準不明確、エッジケース欠落 |
| **Security** | セキュリティ | 認証・認可、データ保護、コンプライアンス |
| **Ops** | 運用性 | 監視、障害対応、保守性 |

## Workflow

### Phase 1: 準備（Preparation）

1. **文書タイプの特定**
   - 設計文書（Design Document）
   - 不具合分析レポート（Incident/Bug Analysis Report）
   - 要件定義書（Requirements Document）
   - 提案書（Proposal）
   - その他報告書

2. **関連文書の収集**
   - 設計文書の場合: 元の要件定義書、前工程のドキュメント
   - 不具合分析の場合: ログファイル、データ、証拠となる資料
   - ユーザーに関連文書の有無を確認

3. **ペルソナの選定**（文書タイプに応じて3〜6ペルソナを自動選定）

   | 文書タイプ | 必須ペルソナ | 推奨ペルソナ | オプション |
   |-----------|-------------|-------------|-----------|
   | 設計文書 | Developer, QA | Security, Ops | PM, Customer |
   | 不具合分析 | Developer, QA, PM | Ops | Security, Customer |
   | 要件定義 | Developer, PM, Customer | QA | Security, Ops |
   | 提案書 | PM, Customer | Developer | Security, Ops, QA |
   | セキュリティ設計 | Security, Developer | Ops | PM, QA, Customer |
   | 運用設計 | Ops, Developer | Security | PM, QA, Customer |
   | 汎用 | Developer, PM, Customer | QA, Security, Ops | - |

   **ペルソナ選定ガイドライン:**
   - 最低3ペルソナ、最大6ペルソナまで選定可能
   - 文書タイプに応じて適切な組み合わせを選択
   - セキュリティ・運用の考慮が必要な文書は対応ペルソナを必ず含める

### Phase 2: 並列レビュー（Parallel Review）

選定したペルソナに対応するサブエージェント（3〜6つ）を**並列実行**します。

**利用可能なエージェント:**

| エージェント名 | ペルソナ | 主なフォーカス |
|--------------|---------|---------------|
| `document-reviewer-developer` | Developer | 実装可能性、技術的正確性 |
| `document-reviewer-pm` | PM | リスク、整合性、依存関係 |
| `document-reviewer-customer` | Customer | 要件充足、ビジネス価値 |
| `document-reviewer-qa` | QA | テスト可能性、受入基準 |
| `document-reviewer-security` | Security | セキュリティ、コンプライアンス |
| `document-reviewer-ops` | Ops | 運用性、監視、障害対応 |

各サブエージェントには以下を渡します：
- レビュー対象文書
- 関連文書（あれば）
- 批判的分析フレームワーク（references/critical_analysis_framework.md）

**サブエージェント呼び出し例（設計文書の場合）:**

```
Task tool を使用して選定したペルソナのエージェントを並列起動：

例1: 基本レビュー（3ペルソナ）
- document-reviewer-developer: 実装可能性視点でレビュー
- document-reviewer-qa: テスト可能性視点でレビュー
- document-reviewer-pm: プロジェクトリスク視点でレビュー

例2: セキュリティ重視レビュー（5ペルソナ）
- document-reviewer-developer: 実装可能性視点
- document-reviewer-qa: テスト可能性視点
- document-reviewer-security: セキュリティ視点
- document-reviewer-ops: 運用性視点
- document-reviewer-pm: プロジェクトリスク視点
```

### Phase 3: 統合（Integration）

サブエージェントからの結果を統合：

1. **指摘事項の収集**
   - 全ペルソナ（3〜6つ）のレビュー結果を収集
   - 各指摘事項を構造化

2. **重複排除**
   - 同じ問題を異なる視点で指摘している場合は統合
   - 視点の違いは「関連ペルソナ」として記録

3. **重大度の付与**

   | 重大度 | 定義 | 例 |
   |--------|------|-----|
   | **Critical** | 根拠なし、または重大な論理誤謬 | 結論に証拠がない |
   | **Major** | 根拠不十分、曖昧さが実害を招く | 「〜と思われる」が重要判断に |
   | **Minor** | 表現の改善が望ましい | 曖昧だが影響は軽微 |
   | **Info** | 参考情報、改善提案 | より良い表現の提案 |

4. **総合レビューレポート生成**
   - assets/review_report_template.md を使用

## Persona Definitions

### Persona 1: 開発メンバー / Implementer

**役割**: 実際にこの文書を元に作業する人

**主な関心事**:
- 実装可能性: これで本当に実装できるか？
- 技術的正確性: 技術的な記述は正しいか？
- 曖昧さ: 解釈の余地がある箇所はないか？
- 前提条件: 前提は明示されているか？妥当か？
- 実務上の懸念: 実際にやろうとすると困る点はないか？

**問いかけ例**:
- 「この仕様で実装を始められるか？」
- 「不明点を誰かに確認せずに進められるか？」
- 「この前提条件は本当に成り立つか？」

### Persona 2: プロジェクトマネージャー / PM

**役割**: プロジェクト全体を管理する人

**主な関心事**:
- リスク: 見落としているリスクはないか？
- 整合性: 他のドキュメントや決定事項との矛盾はないか？
- 実現性: スケジュール・リソースの観点で現実的か？
- 依存関係: 他タスクとの依存は明確か？
- 完成度: このまま次工程に進めて大丈夫か？

**問いかけ例**:
- 「このドキュメントに従って進めてプロジェクトは成功するか？」
- 「記載されていないリスクはないか？」
- 「前工程のドキュメントと矛盾していないか？」

### Persona 3: お客様 / Customer

**役割**: 最終的な成果物を受け取る人

**主な関心事**:
- 要件充足: 要件を満たしているか？
- 期待との整合: 期待していたものと合っているか？
- 理解しやすさ: 内容を理解できるか？
- ビジネス価値: ビジネス目的を達成できるか？
- 受け入れ可能性: これを受け入れられるか？

**問いかけ例**:
- 「これは私が求めていたものか？」
- 「なぜこの設計になったのか理解できるか？」
- 「要件と紐付けて説明されているか？」

### Persona 4: QA担当 / QA Engineer

**役割**: この文書を元にテスト計画・テストケースを作成し、成果物を検証する人

**主な関心事**:
- テスト可能性: 受入基準は明確で検証可能か？
- 受入基準の明確性: Given-When-Then形式で書けるほど具体的か？
- エッジケース: 境界値、異常系は考慮されているか？
- 曖昧な表現: 「適切に」「必要に応じて」等の主観的表現はないか？
- 性能要件: 測定可能な形で定義されているか？

**問いかけ例**:
- 「この要件はYes/Noで合否判定できるか？」
- 「エラー時の振る舞いは明確に定義されているか？」
- 「境界値（0件、1件、最大件数）の動作は定義されているか？」
- 「性能要件は具体的な数値で書かれているか？」

### Persona 5: セキュリティ担当 / Security Engineer

**役割**: セキュリティ設計レビュー、脆弱性評価、コンプライアンス監査を担当する人

**主な関心事**:
- 認証・認可: 認証方式は適切か？認可の粒度は十分か？
- データ保護: 機密データの分類、暗号化要件は明確か？
- プライバシー・コンプライアンス: GDPR、個人情報保護法等への準拠
- 監査・トレーサビリティ: 監査ログ要件、追跡可能性
- 脆弱性パターン: インジェクション、XSS等の対策

**問いかけ例**:
- 「認証・認可モデルは定義されているか？」
- 「機密データは特定・分類されているか？」
- 「監査ログに何を記録するか定義されているか？」
- 「攻撃者ならどう悪用するか？」

### Persona 6: 運用担当 / Operations Engineer

**役割**: 本番環境の運用・監視・インシデント対応を担当するSRE/運用エンジニア

**主な関心事**:
- 監視・可観測性: 何を監視すべきか？アラート条件は？
- 障害モードと復旧: 想定障害パターン、復旧手順、ロールバック方法
- 運用負荷: 日常運用タスク、手動作業の頻度と工数
- 保守性: 設定変更手順、デプロイ手順、ドキュメント
- キャパシティ: スケーリング手順、リソース枯渇時の対応

**問いかけ例**:
- 「これは本番で運用できるか？」
- 「障害発生時、最初に何を確認すべきか？」
- 「深夜に障害が起きたら、誰がどう対応するか？」
- 「ロールバックはどのように行うか？」

## Critical Analysis Framework

各レビュアーは以下のフレームワークを適用します：

### 1. 主張の特定（Claim Identification）

文書内の主張・結論を抽出:
- 明示的な結論（「〜である」「〜とする」）
- 暗黙の前提（言及されていないが仮定されている事項）
- 判断・決定事項

### 2. 根拠の検証（Evidence Validation）

各主張に対して:

```
┌─────────────────────────────────────────────┐
│ 主張: [主張内容]                              │
├─────────────────────────────────────────────┤
│ Q1: これは事実か、解釈か？                    │
│ Q2: 根拠は明示されているか？                  │
│ Q3: その根拠は十分か？                        │
│ Q4: 根拠の出典は信頼できるか？                │
│ Q5: 他の解釈・説明は検討されたか？            │
└─────────────────────────────────────────────┘
```

### 3. 論理の検証（Logic Validation）

- **因果関係の検証**: AがBの原因と言えるか？相関ではないか？
- **論理の連鎖**: A→B→Cの各ステップは妥当か？
- **前提条件**: 暗黙の前提は正しいか？
- **一般化の妥当性**: 特定の事例から一般化できるか？

### 4. 危険な表現パターン（Red Flag Patterns）

以下の表現を検出したら重点的に検証:

| パターン | 例 | 問題 |
|---------|-----|------|
| 推測表現 | 「〜と思われる」「おそらく」 | 根拠なしの推測？ |
| 断定表現 | 「〜に違いない」「明らかに」 | 根拠は十分か？ |
| 曖昧な主語 | 「一般的に」「通常」 | 具体的な根拠は？ |
| 省略 | 「等」「など」 | 何が省略されている？ |
| 因果の飛躍 | 「〜なので〜である」 | 論理の飛躍はないか？ |

## Output Format

レビュー結果は以下の形式で出力:

```markdown
# 批判的レビューレポート

## 文書情報
- 対象文書: [文書名]
- 文書タイプ: [タイプ]
- レビュー日: [日付]
- 関連文書: [あれば記載]

## レビューサマリー

| 重大度 | 件数 |
|--------|------|
| Critical | X |
| Major | X |
| Minor | X |
| Info | X |

## 指摘事項一覧

### Critical

#### [CR-001] [タイトル]
- **該当箇所**: [文書内の該当部分]
- **問題**: [何が問題か]
- **根拠評価**: [根拠がない/不十分な理由]
- **関連ペルソナ**: [どの視点から検出されたか]
- **推奨アクション**: [どう修正すべきか]

### Major
...

## ペルソナ別レビュー詳細

### Developer視点
[技術的実装可能性に関する指摘]

### PM視点
[リスク・整合性に関する指摘]

### Customer視点
[要件充足・ビジネス価値に関する指摘]

### QA視点（該当する場合）
[テスト可能性・受入基準に関する指摘]

### Security視点（該当する場合）
[セキュリティ・コンプライアンスに関する指摘]

### Ops視点（該当する場合）
[運用性・障害対応に関する指摘]

## 総合評価

[文書全体の評価と推奨事項]
```

## Usage Example

### 例1: 設計文書レビュー（基本）

```
User: この設計書をレビューしてください。要件定義書も添付します。

Claude:
1. [Phase 1] 文書を分析し、設計文書と判断。
   必須ペルソナ: Developer, QA
   推奨ペルソナ: Security, Ops → セキュリティ考慮あり、運用設計含むため追加
   → 4ペルソナでレビュー実行
2. [Phase 2] 4つのサブエージェントを並列起動:
   - document-reviewer-developer: 実装可能性視点
   - document-reviewer-qa: テスト可能性視点
   - document-reviewer-security: セキュリティ視点
   - document-reviewer-ops: 運用性視点
3. [Phase 3] 結果を統合し、レビューレポートを生成。
```

### 例2: 要件定義書レビュー

```
User: この要件定義書をレビューしてください。

Claude:
1. [Phase 1] 文書を分析し、要件定義書と判断。
   必須ペルソナ: Developer, PM, Customer
   推奨ペルソナ: QA → テスト可能な要件確認のため追加
   → 4ペルソナでレビュー実行
2. [Phase 2] 4つのサブエージェントを並列起動:
   - document-reviewer-developer: 実装可能性視点
   - document-reviewer-pm: リスク・整合性視点
   - document-reviewer-customer: 要件充足視点
   - document-reviewer-qa: テスト可能性視点
3. [Phase 3] 結果を統合し、レビューレポートを生成。
```

### 例3: セキュリティ設計レビュー（徹底レビュー）

```
User: この認証システムの設計書を徹底レビューしてください。

Claude:
1. [Phase 1] 文書を分析し、セキュリティ設計と判断。
   → 全6ペルソナでレビュー実行（重要文書のため）
2. [Phase 2] 6つのサブエージェントを並列起動:
   - document-reviewer-developer
   - document-reviewer-pm
   - document-reviewer-customer
   - document-reviewer-qa
   - document-reviewer-security
   - document-reviewer-ops
3. [Phase 3] 結果を統合し、レビューレポートを生成。
```
